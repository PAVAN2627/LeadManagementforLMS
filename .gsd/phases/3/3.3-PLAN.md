---
phase: 3
plan: 3.3
wave: 3
---

# Plan 3.3: Real-Time Notifications

## Objective
Establish a simple, polling-based Notification system allowing real-time context updates (e.g., when a lead is assigned) fulfilling REQ-09.

## Context
Load these files for context:
- .gsd/SPEC.md
- src/components/layout/Header.tsx
- api/notifications/index.ts

## Tasks

<task type="auto">
  <name>Create Notification Model & API endpoints</name>
  <files>
    models/Notification.ts
    api/notifications/index.ts
  </files>
  <action>
    Generate a Mongoose `Notification` schema containing standard notification fields (userId, type, message, isRead, timestamps).
    Create an `api/notifications` function handling `GET` requests (for unread counts and a list of notifications) and `PATCH` requests (to mark as read).
  </action>
  <verify>Check Mongoose schemas and endpoint responses.</verify>
  <done>Notification model and querying routes are fully robust.</done>
</task>

<task type="auto">
  <name>Enable Triggering Notifications</name>
  <files>
    api/leads/[id].ts
    api/leads/index.ts
  </files>
  <action>
    Modify lead creation or assignment pipelines in API endpoints. When a lead is assigned or an important note added, actively spawn a new `Notification` tied to the respective user.
  </action>
  <verify>Assign a lead and then query the notification DB.</verify>
  <done>Notifications correctly populated in the database during system actions.</done>
</task>

<task type="auto">
  <name>Implement Frontend Notification Polling & UI</name>
  <files>
    src/components/layout/Header.tsx
    src/lib/api.ts
  </files>
  <action>
    Create a React Query hook inside `Header.tsx` that polls `fetchNotifications()` conditionally.
    Update the Notification Bell UI icon to reflect unread counts and implement a drop-down reading mechanics where users can click to `markAsRead`.
  </action>
  <verify>Verify network tab for HTTP polling behaviour in development tools.</verify>
  <done>Notification UI accurately displays database driven unread counts and can clear them.</done>
</task>

## Success Criteria
- [ ] Notifications reliably created on assignment triggers.
- [ ] Front-end header correctly displays polling updates via UI.
