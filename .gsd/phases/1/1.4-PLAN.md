---
phase: 1
plan: 1.4
wave: 2
---

# Plan 1.4: Frontend Integration

## Objective
Connect the React frontend to the new backend authentication system. Replace any mock auth logic with real API calls and secure route protection.

## Context
- .gsd/SPEC.md (Goal 2: Secure Authentication)
- REQ-04: RBAC Middleware (Frontend side)

## Tasks

<task type="auto">
  <name>Update Auth Context</name>
  <files>src/context/AuthContext.tsx</files>
  <action>
    Create or Update `AuthContext` to:
    1. Store `user` and `token` in state.
    2. Provide `login(email, password)` method that calls `/api/auth/login`.
    3. Provide `logout()` method.
    4. On mount, check for stored token and call `/api/auth/me` to restore session.
  </action>
  <verify>grep "AuthContext" src/context/AuthContext.tsx</verify>
  <done>AuthContext manages real async login/logout flows.</done>
</task>

<task type="auto">
  <name>Implement Protected Route</name>
  <files>src/components/ProtectedRoute.tsx</files>
  <action>
    Create a wrapper component `ProtectedRoute`.
    - Props: `allowedRoles?: string[]`.
    - Logic:
      - If loading, show spinner.
      - If not authenticated, redirect to `/login`.
      - If authenticated but role not allowed, redirect to unauthorized (or dashboard).
      - Render children if valid.
  </action>
  <verify>test -f src/components/ProtectedRoute.tsx</verify>
  <done>Routes can be protected by role.</done>
</task>

<task type="auto">
  <name>Integrate Login Page</name>
  <files>src/pages/Login.tsx, src/App.tsx</files>
  <action>
    1. Update `Login.tsx` to use `useAuth().login`.
    2. Update `App.tsx` routes to wrap Admin/Manager/Agent routes with `ProtectedRoute` specifying correct roles.
    3. Ensure redirects happen after successful login.
  </action>
  <verify>grep "ProtectedRoute" src/App.tsx</verify>
  <done>Application enforces authentication on secure routes.</done>
</task>

## Success Criteria
- [ ] User can log in via UI.
- [ ] Protected routes block unauthenticated access.
- [ ] Refreshing page maintains session (via token check).
