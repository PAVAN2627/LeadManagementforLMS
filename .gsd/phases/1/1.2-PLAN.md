---
phase: 1
plan: 1.2
wave: 1
---

# Plan 1.2: User Model & Security

## Objective
Implement the User data model and security utilities. This prepares the application for authentication by defining how users are stored and how passwords are secured.

## Context
- .gsd/SPEC.md (Goal 2: User Model & Auth)
- REQ-02: User Model

## Tasks

<task type="auto">
  <name>Install Security Dependencies</name>
  <files>package.json</files>
  <action>
    Install security libraries:
    - `bcryptjs`: For password hashing
    - `@types/bcryptjs`: Type definitions
    - `zod`: For schema validation (already in project, verify version)
  </action>
  <verify>npm list bcryptjs zod</verify>
  <done>Security dependencies installed.</done>
</task>

<task type="auto">
  <name>Create User Model</name>
  <files>src/models/User.ts</files>
  <action>
    Define Mongoose schema for User.
    - Fields: name, email (unique), password (hash), role (enum: 'Admin', 'Manager', 'Agent'), status (active/inactive), createdAt.
    - Export TypeScript interface `IUser`.
    - Export Mongoose model `User`.
  </action>
  <verify>grep "Schema" src/models/User.ts</verify>
  <done>User model defined with correct fields and types.</done>
</task>

<task type="auto">
  <name>Implement Auth Utilities</name>
  <files>src/lib/auth-utils.ts</files>
  <action>
    Create helper functions for security:
    - `hashPassword(password: string): Promise<string>`
    - `comparePassword(password: string, hash: string): Promise<boolean>`
    
    These will be used by the API endpoints.
  </action>
  <verify>grep "hashPassword" src/lib/auth-utils.ts</verify>
  <done>Password hashing utilities implemented.</done>
</task>

## Success Criteria
- [ ] User Mongoose model created with Role enum.
- [ ] Password hashing utilities ready for use.
