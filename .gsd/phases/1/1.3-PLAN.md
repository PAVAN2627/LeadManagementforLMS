---
phase: 1
plan: 1.3
wave: 2
---

# Plan 1.3: Authentication API

## Objective
Build the serverless API endpoints for user authentication. This includes login (token generation) and session verification.

## Context
- .gsd/SPEC.md (Goal 2: Secure Authentication)
- REQ-03: Auth API

## Tasks

<task type="auto">
  <name>Install JWT Dependencies</name>
  <files>package.json</files>
  <action>
    Install:
    - `jsonwebtoken`: For JWT creation/verification
    - `@types/jsonwebtoken`: Type definitions
    - `cookie`: For cookie parsing (optional, if using cookies, else Bearer tokens are fine. We will use Bearer tokens for simplicity with local storage as per typical JWT flows, or httpOnly cookies if preferred. Sticking to standard Authorization header approach for this phase is often easier for SPAs unless strict security is requested. Let's stick to standard returning of token).
  </action>
  <verify>npm list jsonwebtoken</verify>
  <done>JWT library installed.</done>
</task>

<task type="auto">
  <name>Create JWT Utilities</name>
  <files>src/lib/jwt.ts</files>
  <action>
    Create `src/lib/jwt.ts` to encapsulate JWT logic.
    - Export `signToken(payload: object): string`
    - Export `verifyToken(token: string): object | null`
    - Use `JWT_SECRET` from environment.
    - Standardize expiration (e.g., '1d').
  </action>
  <verify>test -f src/lib/jwt.ts</verify>
  <done>JWT utility module created.</done>
</task>

<task type="auto">
  <name>Create Login Endpoint</name>
  <files>api/auth/login.ts</files>
  <action>
    Create Vercel function at `api/auth/login.ts`.
    1. Connect to DB.
    2. Validate input (Zod).
    3. Find user by email.
    4. Verify password.
    5. Generate JWT (payload: userId, role).
    6. Return token and user info.
    
    *Validation Schema:* Email, Password required.
  </action>
  <verify>test -f api/auth/login.ts</verify>
  <done>Login endpoint accepts credentials and returns JWT.</done>
</task>

<task type="auto">
  <name>Create Me Endpoint</name>
  <files>api/auth/me.ts</files>
  <action>
    Create Vercel function at `api/auth/me.ts` to validate current session.
    1. Parse Authorization header (Bearer token).
    2. Verify JWT.
    3. Fetch user from DB (exclude password).
    4. Return user object.
  </action>
  <verify>test -f api/auth/me.ts</verify>
  <done>Me endpoint verifies token and returns user context.</done>
</task>

## Success Criteria
- [ ] Login API returns status 200 and Token for valid creds.
- [ ] Me API returns user profile for valid tokens.
